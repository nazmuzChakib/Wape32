<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WAPE32 | Wi-Fi Penetration Tool</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --primary-light: #818cf8;
        --secondary: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --bg-dark: #0f0f23;
        --bg-card: #1a1b2e;
        --bg-card-light: #23243a;
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border: #2d2f45;
        --border-light: #3f4158;
        --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        --radius: 12px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(135deg, var(--bg-dark) 0%, #151528 100%);
        color: var(--text-primary);
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        min-height: 100vh;
        padding: 20px;
        position: relative;
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 80%,
            rgba(99, 102, 241, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(16, 185, 129, 0.1) 0%,
            transparent 50%
          );
        z-index: -1;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px 0;
        position: relative;
      }

      .logo {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-bottom: 10px;
      }

      .logo-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        box-shadow: var(--shadow);
      }

      h1 {
        font-weight: 700;
        font-size: 2.5rem;
        background: linear-gradient(
          90deg,
          var(--primary) 0%,
          var(--primary-light) 100%
        );
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        margin-bottom: 5px;
      }

      .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
        margin-bottom: 15px;
      }

      .version {
        display: inline-block;
        background: var(--bg-card);
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        color: var(--text-muted);
        border: 1px solid var(--border);
      }

      .disclaimer {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: var(--radius);
        padding: 15px;
        margin: 25px 0;
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .disclaimer strong {
        color: #fca5a5;
      }

      .card {
        background: var(--bg-card);
        border-radius: var(--radius);
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
        transition: var(--transition);
      }

      .card:hover {
        border-color: var(--border-light);
      }

      .card-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .card-title i {
        color: var(--primary);
      }

      .attack-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .attack-type {
        background: var(--bg-card-light);
        border: 2px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .attack-type:hover {
        border-color: var(--primary-light);
        transform: translateY(-5px);
      }

      .attack-type.selected {
        border-color: var(--primary);
        background: rgba(99, 102, 241, 0.1);
      }

      .attack-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .attack-name {
        font-weight: 600;
        font-size: 1.1rem;
      }

      .attack-desc {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
      }

      th,
      td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }

      th {
        color: var(--text-muted);
        font-weight: 500;
        font-size: 0.9rem;
      }

      tr {
        transition: var(--transition);
        cursor: pointer;
      }

      tr:hover {
        background: var(--bg-card-light);
      }

      tr.selected {
        background: rgba(99, 102, 241, 0.15);
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-secondary);
      }

      select,
      input {
        width: 100%;
        padding: 12px 15px;
        background: var(--bg-card-light);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text-primary);
        font-family: inherit;
        transition: var(--transition);
      }

      select:focus,
      input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--primary-dark) 100%
        );
        color: white;
        border: none;
        padding: 12px 24px;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: var(--shadow);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: var(--bg-card-light);
        color: var(--text-primary);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--bg-card);
        border-color: var(--border-light);
      }

      .btn-danger {
        background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
      }

      .btn-full {
        width: 100%;
        justify-content: center;
        padding: 15px;
        font-size: 1.1rem;
      }

      .result-content {
        background: var(--bg-card-light);
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        overflow-x: auto;
      }

      .result-content code {
        background: rgba(0, 0, 0, 0.3);
        padding: 3px 6px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        color: var(--primary-light);
      }

      .result-content pre {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 8px;
        overflow-x: auto;
        margin-top: 15px;
        border: 1px solid var(--border);
      }

      .footer {
        text-align: center;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      .footer a {
        color: var(--primary-light);
        text-decoration: none;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .status-ready {
        background: rgba(16, 185, 129, 0.2);
        color: var(--secondary);
      }

      .status-running {
        background: rgba(245, 158, 11, 0.2);
        color: var(--warning);
      }

      .status-error {
        background: rgba(239, 68, 68, 0.2);
        color: #fca5a5;
      }

      .hidden {
        display: none;
      }

      .flex {
        display: flex;
      }

      .justify-between {
        justify-content: space-between;
      }

      .items-center {
        align-items: center;
      }

      .gap-4 {
        gap: 16px;
      }

      .mt-4 {
        margin-top: 16px;
      }

      .mb-4 {
        margin-bottom: 16px;
      }

      .text-center {
        text-align: center;
      }

      @media (max-width: 768px) {
        .container {
          padding: 0 10px;
        }

        h1 {
          font-size: 2rem;
        }

        .attack-types {
          grid-template-columns: 1fr;
        }

        .card {
          padding: 20px;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header>
        <div class="logo">
          <div class="logo-icon"><i class="fas fa-wifi"></i></div>
          <div>
            <h1>ESP32 Wi-Fi PenTool</h1>
            <p class="subtitle">Advanced Wireless Security Assessment Tool</p>
          </div>
        </div>
        <div class="version">
          Firmware Version: V1.0.2 | Developed by
          <a
            style="text-decoration: none"
            href="https://github.com/nazmuzChakib"
            ><b>Nazmuz Chakib</b></a
          >
        </div>
      </header>
      <div class="disclaimer">
        <strong
          ><i class="fas fa-exclamation-triangle"></i> Important
          Disclaimer:</strong
        >
        This tool is for
        <strong
          >security penetration testing and educational purposes only</strong
        >. Unauthorized use is strictly prohibited. Use responsibly and at your
        own risk.
      </div>
      <section id="errors" class="card hidden">
        <div class="status-indicator status-error">
          <i class="fas fa-exclamation-circle"></i
          ><span id="error-message"></span>
        </div>
      </section>
      <section id="loading" class="card text-center">
        <div class="card-title">
          <i class="fas fa-spinner fa-spin"></i><span>Initializing System</span>
        </div>
        <p>Loading... Please wait while the system initializes</p>
      </section>
      <section id="ready" class="hidden">
        <div class="card">
          <div class="card-title">
            <i class="fas fa-bullseye"></i><span>Select Target Network</span>
          </div>
          <div class="flex justify-between items-center mb-4">
            <h3>Available Access Points</h3>
            <div class="status-indicator status-ready">
              <i class="fas fa-check-circle"></i><span>Ready</span>
            </div>
          </div>
          <div class="result-content">
            <table id="ap-list">
              <thead>
                <tr>
                  <th>SSID</th>
                  <th>BSSID</th>
                  <th>Signal</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="3" class="text-center">
                    Scanning for Access Points...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="flex justify-between mt-4">
            <button class="btn btn-secondary" onClick="refreshAps()">
              <i class="fas fa-sync-alt"></i> Refresh Networks
            </button>
            <div><span id="ap-count">0</span> networks found</div>
          </div>
        </div>
        <div class="card">
          <div class="card-title">
            <i class="fas fa-bolt"></i><span>Choose Attack Type</span>
          </div>
          <div class="attack-types">
            <div
              class="attack-type"
              id="handshake_button"
              onClick="selectAttackType(AttackTypeEnum.ATTACK_TYPE_HANDSHAKE)"
            >
              <div class="attack-icon"><i class="fas fa-handshake"></i></div>
              <div class="attack-name">Handshake Capture</div>
              <div class="attack-desc">
                Capture WPA/WPA2 handshakes for offline cracking
              </div>
            </div>
            <div
              class="attack-type"
              id="pmkid_button"
              onClick="selectAttackType(AttackTypeEnum.ATTACK_TYPE_PMKID)"
            >
              <div class="attack-icon"><i class="fas fa-key"></i></div>
              <div class="attack-name">PMKID Capture</div>
              <div class="attack-desc">
                Extract PMKID from vulnerable APs without clients
              </div>
            </div>
            <div
              class="attack-type"
              id="deauth_button"
              onClick="selectAttackType(AttackTypeEnum.ATTACK_TYPE_DOS)"
            >
              <div class="attack-icon">
                <i class="fas fa-broadcast-tower"></i>
              </div>
              <div class="attack-name">Deauthentication</div>
              <div class="attack-desc">
                Disconnect clients from target network (DoS)
              </div>
            </div>
          </div>
        </div>
        <div class="card" id="attack_details_fieldset" style="display: none">
          <div class="card-title">
            <i class="fas fa-sliders-h"></i
            ><span id="attack_details_legend">Attack Parameters</span>
          </div>
          <div
            id="attack_description_container"
            class="mb-4"
            style="display: none"
          >
            <div class="result-content">
              <p id="attack_description_text"></p>
            </div>
          </div>
          <div
            class="form-group"
            id="attack_method_container"
            style="display: none"
          >
            <label for="attack_method">Attack Method</label
            ><select id="attack_method" required disabled>
              <option value="" selected disabled hidden>
                Select method...
              </option>
            </select>
          </div>
          <div class="form-group" id="timeout_input_container">
            <label for="attack_timeout_input">Attack Duration (seconds)</label
            ><input
              type="number"
              min="0"
              max="255"
              id="attack_timeout_input"
              value=""
              required
            />
          </div>
          <button
            type="submit"
            class="btn btn-full"
            id="start_attack_button"
            style="display: none"
            onclick="runAttack(); return false;"
          >
            <i class="fas fa-play"></i> Initiate Attack
          </button>
        </div>
      </section>
      <section id="running" class="card hidden">
        <div class="card-title">
          <i class="fas fa-hourglass-half"></i><span>Attack in Progress</span>
        </div>
        <p>Time elapsed: <span id="running-progress">0</span> seconds</p>
      </section>
      <section id="result" class="card hidden">
        <div class="card-title">
          <i class="fas fa-poll"></i><span>Attack Results</span>
        </div>
        <div id="result-meta" class="mb-4"></div>
        <div id="result-content" class="result-content"></div>
        <div class="flex gap-4 mt-4">
          <button class="btn btn-secondary" onClick="resetAttack()">
            <i class="fas fa-redo"></i> New Attack
          </button>
        </div>
      </section>
      <footer class="footer">
        <p>
          Developed by
          <a href="https://github.com/nazmuzChakib">Nazmuz Chakib</a> | ESP32
          Wi-Fi PenTool
        </p>
      </footer>
    </div>
    <script>
      var AttackStateEnum = { READY: 0, RUNNING: 1, FINISHED: 2, TIMEOUT: 3 };
      var AttackTypeEnum = {
        ATTACK_TYPE_PASSIVE: 0,
        ATTACK_TYPE_HANDSHAKE: 1,
        ATTACK_TYPE_PMKID: 2,
        ATTACK_TYPE_DOS: 3,
      };
      var selectedApElement = -1;
      var selectedAttackType = null;
      var poll;
      var poll_interval = 1000;
      var running_poll;
      var running_poll_interval = 1000;
      var attack_timeout = 0;
      var time_elapsed = 0;
      var defaultResultContent = document.getElementById("result").innerHTML;
      var defaultAttackMethods =
        document.getElementById("attack_method").outerHTML;
      document.addEventListener("DOMContentLoaded", function () {
        getStatus();
      });
      function getStatus() {
        var oReq = new XMLHttpRequest();
        oReq.onload = function () {
          var arrayBuffer = oReq.response;
          if (arrayBuffer) {
            var attack_state = parseInt(new Uint8Array(arrayBuffer, 0, 1));
            var attack_type = parseInt(new Uint8Array(arrayBuffer, 1, 1));
            var attack_content_size = parseInt(
              new Uint16Array(arrayBuffer, 2, 1)
            );
            var attack_content = new Uint8Array(arrayBuffer, 4);
            console.log(
              "Attack state: " +
                attack_state +
                "; Attack type: " +
                attack_type +
                "; Content size: " +
                attack_content_size
            );
            hideAllSections();
            switch (attack_state) {
              case AttackStateEnum.READY:
                showAttackConfig();
                break;
              case AttackStateEnum.RUNNING:
                showRunning();
                console.log("Polling: Attack currently active.");
                setTimeout(getStatus, poll_interval);
                break;
              case AttackStateEnum.FINISHED:
                showResult(
                  "FINISHED",
                  attack_type,
                  attack_content_size,
                  attack_content
                );
                break;
              case AttackStateEnum.TIMEOUT:
                showResult(
                  "TIMEOUT",
                  attack_type,
                  attack_content_size,
                  attack_content
                );
                break;
              default:
                document.getElementById("errors").innerHTML =
                  "Error loading attack status! Unknown state detected.";
                document.getElementById("errors").style.display = "block";
            }
          }
        };
        oReq.onerror = function () {
          console.log("Request error");
          document.getElementById("errors").innerHTML =
            "Cannot reach ESP32. Check that you are connected to management AP. You might get disconnected during attack.";
          document.getElementById("errors").style.display = "block";
          setTimeout(getStatus, poll_interval);
        };
        oReq.ontimeout = function () {
          console.log("Request timeout");
          setTimeout(getStatus, poll_interval);
        };
        oReq.open("GET", "http://192.168.4.1/status", true);
        oReq.responseType = "arraybuffer";
        oReq.send();
      }
      function hideAllSections() {
        for (let section of document.getElementsByTagName("section")) {
          section.style.display = "none";
        }
        document.getElementById("errors").style.display = "none";
      }
      function showRunning() {
        hideAllSections();
        document.getElementById("running").style.display = "block";
      }
      function countProgress() {
        if (time_elapsed >= attack_timeout) {
          document.getElementById("errors").innerHTML =
            "Please reconnect to management AP";
          document.getElementById("errors").style.display = "block";
          clearInterval(running_poll);
        }
        document.getElementById("running-progress").innerHTML =
          time_elapsed + "/" + attack_timeout + "s";
        time_elapsed++;
      }
      function showAttackConfig() {
        document.getElementById("ready").style.display = "block";
        refreshAps();
        selectedAttackType = null;
        document.getElementById("deauth_button").classList.remove("selected");
        document
          .getElementById("handshake_button")
          .classList.remove("selected");
        document.getElementById("pmkid_button").classList.remove("selected");
        document.getElementById("attack_details_fieldset").style.display =
          "none";
        document.getElementById("start_attack_button").style.display = "none";
        document.getElementById("attack_description_container").style.display =
          "none";
        document.getElementById("attack_description_text").innerText = "";
      }
      function showResult(
        status,
        attack_type,
        attack_content_size,
        attack_content
      ) {
        hideAllSections();
        clearInterval(poll);
        clearInterval(running_poll);
        document.getElementById("result").innerHTML = defaultResultContent;
        document.getElementById("result").style.display = "block";
        document.getElementById("result-meta").innerHTML = status + "<br>";
        let type_str = "ERROR: Cannot parse attack type.";
        switch (attack_type) {
          case AttackTypeEnum.ATTACK_TYPE_PASSIVE:
            type_str = "ATTACK_TYPE_PASSIVE";
            break;
          case AttackTypeEnum.ATTACK_TYPE_HANDSHAKE:
            type_str = "ATTACK_TYPE_HANDSHAKE";
            resultHandshake(attack_content, attack_content_size);
            break;
          case AttackTypeEnum.ATTACK_TYPE_PMKID:
            type_str = "ATTACK_TYPE_PMKID";
            resultPmkid(attack_content, attack_content_size);
            break;
          case AttackTypeEnum.ATTACK_TYPE_DOS:
            type_str = "ATTACK_TYPE_DOS";
            break;
          default:
            type_str = "UNKNOWN";
        }
        document.getElementById("result-meta").innerHTML += type_str + "<br>";
      }
      function refreshAps() {
        document.getElementById("ap-list").innerHTML =
          "<thead><tr><th>SSID</th><th>BSSID</th><th>Signal</th></tr></thead><tbody><tr><td colspan='3' class='text-center'>Loading (this may take a while)...</td></tr></tbody>";
        var oReq = new XMLHttpRequest();
        oReq.onload = function () {
          document.getElementById("ap-list").innerHTML =
            "<thead><tr><th>SSID</th><th>BSSID</th><th>Signal</th></tr></thead><tbody>";
          var arrayBuffer = oReq.response;
          if (arrayBuffer) {
            var byteArray = new Uint8Array(arrayBuffer);
            let apCount = 0;
            for (let i = 0; i < byteArray.byteLength; i = i + 40) {
              var tr = document.createElement("tr");
              tr.setAttribute("id", i / 40);
              tr.setAttribute("onClick", "selectAp(this)");
              var td_ssid = document.createElement("td");
              let ssid_raw = new TextDecoder("utf-8").decode(
                byteArray.subarray(i + 0, i + 32)
              );
              td_ssid.innerHTML = ssid_raw.replace(/\0/g, "");
              tr.appendChild(td_ssid);
              var td_bssid = document.createElement("td");
              for (let j = 0; j < 6; j++) {
                td_bssid.innerHTML += uint8ToHex(byteArray[i + 33 + j]) + ":";
              }
              td_bssid.innerHTML = td_bssid.innerHTML.slice(0, -1);
              tr.appendChild(td_bssid);
              var td_rssi = document.createElement("td");
              let rssi = byteArray[i + 39] - 255;
              td_rssi.innerHTML = `<div class="flex items-center gap-2"><div style="width: 60px; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden;"><div style="width: ${Math.min(
                100,
                Math.max(0, (rssi + 100) * 2)
              )}%; height: 100%; background: ${
                rssi > -50 ? "#10b981" : rssi > -70 ? "#f59e0b" : "#ef4444"
              };"></div></div><span>${rssi} dBm</span></div>`;
              tr.appendChild(td_rssi);
              document.getElementById("ap-list").appendChild(tr);
              apCount++;
            }
            document.getElementById("ap-list").innerHTML += "</tbody>";
            document.getElementById("ap-count").textContent = apCount;
          }
        };
        oReq.onerror = function () {
          document.getElementById("ap-list").innerHTML =
            "<thead><tr><th>SSID</th><th>BSSID</th><th>Signal</th></tr></thead><tbody><tr><td colspan='3' class='text-center'>ERROR</td></tr></tbody>";
          document.getElementById("ap-count").textContent = "0";
        };
        oReq.open("GET", "http://192.168.4.1/ap-list", true);
        oReq.responseType = "arraybuffer";
        oReq.send();
      }
      function selectAp(el) {
        console.log("Selected AP ID: " + el.id);
        if (selectedApElement != -1) {
          selectedApElement.classList.remove("selected");
        }
        selectedApElement = el;
        el.classList.add("selected");
      }
      function selectAttackType(type) {
        selectedAttackType = type;
        document.getElementById("deauth_button").classList.remove("selected");
        document
          .getElementById("handshake_button")
          .classList.remove("selected");
        document.getElementById("pmkid_button").classList.remove("selected");
        if (type === AttackTypeEnum.ATTACK_TYPE_DOS) {
          document.getElementById("deauth_button").classList.add("selected");
        } else if (type === AttackTypeEnum.ATTACK_TYPE_HANDSHAKE) {
          document.getElementById("handshake_button").classList.add("selected");
        } else if (type === AttackTypeEnum.ATTACK_TYPE_PMKID) {
          document.getElementById("pmkid_button").classList.add("selected");
        }
        updateConfigurableFields();
      }
      function runAttack() {
        if (selectedApElement == -1) {
          console.log("No AP selected. Attack not started.");
          document.getElementById("errors").innerHTML =
            "No AP selected. Attack not started.";
          document.getElementById("errors").style.display = "block";
          return;
        }
        hideAllSections();
        document.getElementById("running").style.display = "block";
        var arrayBuffer = new ArrayBuffer(4);
        var uint8Array = new Uint8Array(arrayBuffer);
        uint8Array[0] = parseInt(selectedApElement.id);
        uint8Array[1] = selectedAttackType;
        uint8Array[2] =
          parseInt(document.getElementById("attack_method").value) || 0;
        uint8Array[3] = parseInt(
          document.getElementById("attack_timeout_input").value
        );
        var oReq = new XMLHttpRequest();
        oReq.open("POST", "http://192.168.4.1/run-attack", true);
        oReq.send(arrayBuffer);
        getStatus();
        attack_timeout = parseInt(
          document.getElementById("attack_timeout_input").value
        );
        time_elapsed = 0;
        running_poll = setInterval(countProgress, running_poll_interval);
      }
      function resetAttack() {
        hideAllSections();
        showAttackConfig();
        var oReq = new XMLHttpRequest();
        oReq.open("HEAD", "http://192.168.4.1/reset", true);
        oReq.send();
        clearInterval(running_poll);
      }
      function resultPmkid(attack_content, attack_content_size) {
        var mac_ap = "";
        var mac_sta = "";
        var ssid = "";
        var ssid_text = "";
        var pmkid = "";
        var index = 0;
        for (let i = 0; i < 6; i = i + 1) {
          mac_ap += uint8ToHex(attack_content[index + i]);
        }
        index = index + 6;
        for (let i = 0; i < 6; i = i + 1) {
          mac_sta += uint8ToHex(attack_content[index + i]);
        }
        index = index + 6;
        for (let i = 0; i < attack_content[index]; i = i + 1) {
          ssid += uint8ToHex(attack_content[index + 1 + i]);
          ssid_text += String.fromCharCode(attack_content[index + 1 + i]);
        }
        index = index + attack_content[index] + 1;
        var pmkid_cnt = 0;
        for (let i = 0; i < attack_content_size - index; i = i + 1) {
          if (i % 16 == 0) {
            pmkid += "<br>";
            pmkid += "</code>PMKID #" + pmkid_cnt + ": <code>";
            pmkid_cnt += 1;
          }
          pmkid += uint8ToHex(attack_content[index + i]);
        }
        document.getElementById("result-content").innerHTML = "";
        document.getElementById("result-content").innerHTML +=
          "MAC AP: <code>" + mac_ap + "</code><br>";
        document.getElementById("result-content").innerHTML +=
          "MAC STA: <code>" + mac_sta + "</code><br>";
        document.getElementById("result-content").innerHTML +=
          "(E)SSID: <code>" + ssid + "</code> (" + ssid_text + ")";
        document.getElementById("result-content").innerHTML +=
          "<code>" + pmkid + "</code><br>";
        document.getElementById("result-content").innerHTML +=
          "<br>Hashcat ready format:";
        document.getElementById("result-content").innerHTML +=
          "<code>" +
          pmkid +
          "*" +
          mac_ap +
          "*" +
          mac_sta +
          "*" +
          ssid +
          "</code><br>";
      }
      function resultHandshake(attack_content, attack_content_size) {
        document.getElementById("result-content").innerHTML = "";
        var pcap_link = document.createElement("a");
        pcap_link.setAttribute("href", "capture.pcap");
        pcap_link.text = "Download PCAP file";
        var hccapx_link = document.createElement("a");
        hccapx_link.setAttribute("href", "capture.hccapx");
        hccapx_link.text = "Download HCCAPX file";
        document.getElementById("result-content").innerHTML +=
          "<p>" + pcap_link.outerHTML + "</p>";
        document.getElementById("result-content").innerHTML +=
          "<p>" + hccapx_link.outerHTML + "</p>";
        var handshakes = "";
        for (let i = 0; i < attack_content_size; i = i + 1) {
          handshakes += uint8ToHex(attack_content[i]);
          if (i % 50 == 49) {
            handshakes += "\n";
          }
        }
        document.getElementById("result-content").innerHTML +=
          "<pre><code>" + handshakes + "</code></pre>";
      }
      function uint8ToHex(uint8) {
        return ("00" + uint8.toString(16)).slice(-2);
      }
      function updateConfigurableFields() {
        const attackMethodContainer = document.getElementById(
          "attack_method_container"
        );
        const attackMethodSelect = document.getElementById("attack_method");
        const attackDetailsFieldset = document.getElementById(
          "attack_details_fieldset"
        );
        const startAttackButton = document.getElementById(
          "start_attack_button"
        );
        const attackDescriptionContainer = document.getElementById(
          "attack_description_container"
        );
        const attackDescriptionText = document.getElementById(
          "attack_description_text"
        );
        attackMethodSelect.innerHTML =
          '<option value="" selected disabled hidden>Select method...</option>';
        attackMethodSelect.setAttribute("disabled", "true");
        attackMethodContainer.style.display = "none";
        attackDetailsFieldset.style.display = "block";
        startAttackButton.style.display = "block";
        attackDescriptionContainer.style.display = "block";
        switch (selectedAttackType) {
          case AttackTypeEnum.ATTACK_TYPE_HANDSHAKE:
            console.log("HANDSHAKE configuration");
            document.getElementById("attack_timeout_input").value = 60;
            document.getElementById("attack_details_legend").innerText =
              "Handshake Capture Parameters";
            attackDescriptionText.innerText =
              "Captures WPA/WPA2 handshakes. May use deauthentication to speed up the process. Requires a target AP.";
            setAttackMethods([
              "DEAUTH_ROGUE_AP (PASSIVE)",
              "DEAUTH_BROADCAST (ACTIVE)",
              "CAPTURE_ONLY (PASSIVE)",
            ]);
            attackMethodContainer.style.display = "block";
            break;
          case AttackTypeEnum.ATTACK_TYPE_PMKID:
            console.log("PMKID configuration");
            document.getElementById("attack_timeout_input").value = 5;
            document.getElementById("attack_details_legend").innerText =
              "PMKID Capture Parameters";
            attackDescriptionText.innerText =
              "Captures PMKIDs from vulnerable (WPA2-PSK) access points. Requires a target AP.";
            break;
          case AttackTypeEnum.ATTACK_TYPE_DOS:
            console.log("DOS configuration");
            document.getElementById("attack_timeout_input").value = 120;
            document.getElementById("attack_details_legend").innerText =
              "Deauthentication (DoS) Parameters";
            attackDescriptionText.innerText =
              "Performs a denial-of-service attack by sending deauthentication frames to a target Wi-Fi network.";
            setAttackMethods([
              "DEAUTH_ROGUE_AP (PASSIVE)",
              "DEAUTH_BROADCAST (ACTIVE)",
              "DEAUTH_COMBINE_ALL",
            ]);
            attackMethodContainer.style.display = "block";
            break;
          default:
            console.log("Unknown or no attack type");
            attackDetailsFieldset.style.display = "none";
            startAttackButton.style.display = "none";
            attackDescriptionContainer.style.display = "none";
            break;
        }
      }
      function setAttackMethods(attackMethodsArray) {
        var attackMethodSelect = document.getElementById("attack_method");
        attackMethodSelect.innerHTML = "";
        attackMethodSelect.removeAttribute("disabled");
        attackMethodsArray.forEach(function (method, index) {
          let option = document.createElement("option");
          option.value = index;
          option.text = method;
          option.selected = true;
          attackMethodSelect.appendChild(option);
        });
      }
    </script>
  </body>
</html>
